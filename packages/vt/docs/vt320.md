# VT320 Capability Notes

## Device Attributes (DA/DA2)
- **Primary DA (DA):** Respond to `CSI c` with `ESC[?62;1;2;6;7;8;9c` to advertise VT320 class, printer port, VAX P/OS, AVO, columns, and Sixel support bits per DEC STD 070.
- **Secondary DA (DA2):** Respond to `CSI > c` with `ESC[>62;1;2c` indicating VT320 firmware version 1, level 2.

## Control Function Toggles
- **S7C1T (`CSI ? 66 h`):** Enter 7-bit control transmission. The parser must stop interpreting single-byte C1 controls and expect ESC-prefixed sequences instead.
- **S8C1T (`CSI ? 66 l`):** Return to 8-bit controls. The parser resumes accepting single-byte C1 controls when enabled in the capability profile.

The interpreter is responsible for tracking the current C1 transmission mode so outgoing responses (DA/DA2, DECRQM, etc.) match host expectations. When S7C1T is active, responses must use 7-bit representations (`ESC`-prefixed).

## National Replacement Character Sets (NRCS)
- VT320 supports the DEC multinational character set plus NRCS designations on G0-G3 via `ESC (`, `ESC )`, `ESC *`, `ESC +` and locking shifts.
- When an NRCS is designated (for example, United Kingdom via `ESC ( A`), the terminal remaps ASCII code points 0x23 and 0x40 to `£` and `£`-compatible glyphs. Glyph translation must respect GL/GR selectors and single-shift overrides.

## Testing Guidance
- Unit tests should assert DA/DA2 responses for `spec: 'vt320'` match the strings above and that flipping S7C1T/S8C1T toggles updates the interpreter state and subsequent responses.
- NRCS verification should cover multi-stage designation (designate G0, lock into GL, write glyphs) to ensure translation tables take effect across GL/GR and single shifts.

## Implementation Notes
- DEC terminals (and Ghostty’s reference implementation) treat S7C1T as a runtime toggle that suppresses single-byte C1 controls and expects ESC-prefixed sequences instead. Nimbus mirrors this behaviour by switching the parser into a 7-bit mode so 0x80–0x9F bytes are ignored until S8C1T re-enables 8-bit handling.
- Device responses are emitted as raw bytes (e.g. `0x9B` for CSI) instead of UTF-8 encoded sequences so downstream transport layers can forward DEC diagnostics without transcoding.
